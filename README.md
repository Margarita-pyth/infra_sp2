## Сервис YaMDb

Проект YaMDb собирает отзывы пользователей на произведения. 
Произведения делятся на категории: «Книги», «Фильмы», «Музыка». 
Список категорий может быть расширен администратором.

- ✨Magic ✨Python

## Технологии

- Django rest_framework
- Django rest_framework_simplejwt
- Django django_filters
- Git
- Docker

## Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:
```sh
git clone https://github.com/Margarita-pyth/api_yamdb.git
```

Перейдите в директорию infra_sp2\infra и создайте файл .env:
Шаблон наполнения файла:
```sh
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME=postgres # имя базы данных
POSTGRES_USER=username # логин для подключения к базе данных
POSTGRES_PASSWORD=password # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД 
```

## Для запуска приложения в контейнерах перейдите в директорию 
infra_sp2\infra и выполните команды:

```sh
docker-compose up -d --build 
```

Выполните миграции:
```sh
docker-compose exec web python manage.py migrate
```

Создайте суперюзера:
```sh
docker-compose exec web python manage.py createsuperuser
```
Подтяните статику:
```sh
docker-compose exec web python manage.py collectstatic --no-input
```

## Теперь проект готов к работе и доступен по адресу http://localhost/api/v1.
## И также доступен доступ к админке: http://localhost/admin/login/?next=/admin/.

Для того чтобы сделать резервную копию базы данных выполните команду
из директории infra_sp2\infra:
```sh
docker-compose exec web python manage.py dumpdata > fixtures.json
```

Для того чтобы скопировать файл  базы данных в контейнер выполните команду:
```sh
docker cp fixtures.json <id-контейнера>:api/fixtures.json
```

И прогрузите сам файл с данными БД командой из директории infra\docker-compose.yaml:
```sh
docker-compose exec web python manage.py loaddata fixtures.json
```

## Руководство к проекту:
### Пользовательские роли
 - Аноним — может просматривать описания произведений, читать отзывы и комментарии.
 - Аутентифицированный пользователь (user) — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.
 - Модератор (moderator) — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.
 - Администратор (admin) — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
 - Суперюзер Django должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.

### Алгоритм регистрации пользователей
 - Пользователь отправляет POST-запрос с параметрами email и username на эндпоинт /api/v1/auth/signup/.
 - Сервис YaMDB отправляет письмо с кодом подтверждения (confirmation_code) на указанный адрес email.
 - Пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен).
 - В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.
 - После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт /api/v1/users/me/ и заполнить поля в своём профайле (описание полей — в документации по ссылке: http://127.0.0.1:8000/redoc/).
 
### Создание пользователя администратором
 - Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт api/v1/users/ (описание полей запроса для этого случая — в документации). 
 - - В этот момент письмо с кодом подтверждения пользователю отправлять не нужно.
После этого пользователь должен самостоятельно отправить свой email и username на эндпоинт /api/v1/auth/signup/ , в ответ ему должно прийти письмо с кодом подтверждения.
 - Далее пользователь отправляет POST-запрос с параметрами username и confirmation_code на эндпоинт /api/v1/auth/token/, в ответе на запрос ему приходит token (JWT-токен), как и при самостоятельной регистрации.

 ## Ресурсы сервиса API YaMDb
- auth: аутентификация.
- users: пользователи.
- titles: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- categories: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- genres: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- reviews: отзывы на произведения. Отзыв привязан к определённому произведению.
- comments: комментарии к отзывам. Комментарий привязан к определённому отзыву.

## License
**Подготовлено командой разработчиков: 

evgenlit,
Aleksandr-Fedotov,
Margarita-pyth
**

___________________________________________________________________________________________